generator client {
  provider               = "prisma-client"
  output                 = "../generated/prisma"
  importFileExtension    = "ts"
  moduleFormat           = "esm"
  generatedFileExtension = "ts"
}

datasource db {
  provider = "postgresql"
}

// ===============================
// USER & AUTHENTICATION
// ===============================
model User {
  id            String    @id @default(cuid())
  name          String?
  firstName     String?
  lastName      String?
  birthdate     String?
  greeting      String?   @db.Text
  tagLine       String?   @db.Text
  email         String?   @unique
  phoneNumber   String?   @unique
  linkedIn      String?   @unique
  facebook      String?   @unique
  github        String?   @unique
  leetCode      String?   @unique
  twitter       String?   @unique
  portfolio     String?   @unique
  stackOverflow String?   @unique
  image         String?
  imageCaption  String?   @db.Text
  quote         String?   @db.Text
  quoteAuthor   String?   @db.Text
  bio           String?   @db.Text
  aboutMe       String?   @db.Text
  emailVerified DateTime?
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  accounts     Account[]
  sessions     Session[]
  blogs        Blog[]
  educations   Education[]
  experiences  Experience[]
  projects     Project[]
  bannerImages UserBannerImage[]
  techstacks   TechStack[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId], map: "uq_accounts_provider_providerAccountId")
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// ===============================
// USER PROFILE COMPONENTS
// ===============================
model UserBannerImage {
  id        String   @id @default(cuid())
  userId    String
  src       String
  caption   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_banner_images")
}

// ===============================
// EDUCATION
// ===============================
model Education {
  id        String   @id @default(cuid())
  userId    String
  timeline  String
  title     String
  message   String?  @db.Text
  icon      String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  subItems EducationSubItem[]

  @@index([userId], map: "idx_educations_user_id")
  @@map("educations")
}

model EducationSubItem {
  id          String   @id @default(cuid())
  educationId String
  title       String
  message     String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  education Education @relation(fields: [educationId], references: [id], onDelete: Cascade)

  @@index([educationId], map: "idx_education_sub_items_education_id")
  @@map("education_sub_items")
}

// ===============================
// TECH STACKS
// ===============================
model TechStack {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  logo      String?
  group     String
  userId    String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user        User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects    TechStackOnProjects[]
  experiences TechStackOnExperiences[]

  @@map("tech_stacks")
}

model TechStackOnProjects {
  projectId   String
  techstackId String
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  techstack TechStack @relation(fields: [techstackId], references: [id], onDelete: Cascade)

  @@id([projectId, techstackId])
  @@index([techstackId], map: "idx_project_tech_stacks_techstack_id")
  @@map("project_tech_stacks")
}

model TechStackOnExperiences {
  experienceId String
  techstackId  String

  experience Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)
  techstack  TechStack  @relation(fields: [techstackId], references: [id], onDelete: Cascade)

  @@id([techstackId, experienceId])
  @@map("experience_tech_stacks")
}

// ===============================
// EXPERIENCE
// ===============================
model Experience {
  id          String   @id @default(cuid())
  userId      String
  company     String
  logoUrl     String
  location    String
  type        String
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user       User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  roles      ExperienceRole[]
  techstacks TechStackOnExperiences[]

  @@index([userId], map: "idx_experiences_user_id")
  @@map("experiences")
}

model ExperienceRole {
  id           String    @id @default(cuid())
  experienceId String
  title        String
  startDate    DateTime
  endDate      DateTime?
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  experience Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)
  tasks      Task[]

  @@index([experienceId], map: "idx_experience_roles_experience_id")
  @@map("experience_roles")
}

model Task {
  id               String   @id @default(cuid())
  experienceRoleId String   @map("experience_role_id")
  content          String   @db.Text
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  experienceRole ExperienceRole @relation(fields: [experienceRoleId], references: [id], onDelete: Cascade)

  @@index([experienceRoleId], map: "idx_tasks_experience_role_id")
  @@map("tasks")
}

// ===============================
// PROJECTS & BLOGS
// ===============================
model Project {
  id          String    @id @default(cuid())
  slug        String    @unique
  userId      String
  title       String
  description String?   @db.Text
  githubLink  String?
  liveLink    String?
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  user       User                       @relation(fields: [userId], references: [id], onDelete: Cascade)
  techstacks TechStackOnProjects[]
  tags       TagsOnProjects[]
  blogs      Blog[]
  coauthors  ProjectOnProjectCoAuthor[]

  @@index([userId], map: "idx_projects_user_id")
  @@map("projects")
}

model ProjectOnProjectCoAuthor {
  projectId  String
  coauthorId String   @map("coauthor_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  project  Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  coauthor Coauthor @relation(fields: [coauthorId], references: [id], onDelete: Cascade)

  @@id([projectId, coauthorId])
  @@index([coauthorId], map: "idx_project_coauthor_coauthor_id")
  @@map("project_coauthor")
}

model Coauthor {
  id       String                     @id @default(cuid())
  fullname String
  email    String?
  projects ProjectOnProjectCoAuthor[]

  @@map("coauthors")
}

model Blog {
  id            String   @id @default(cuid())
  userId        String
  projectId     String?
  title         String
  content       String   @db.Text
  slug          String   @unique
  publishedDate DateTime @default(now())
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  user    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tags    BlogTag[]

  @@index([userId], map: "idx_blogs_user_id")
  @@map("blogs")
}

// ===============================
// TAGS
// ===============================
model Tag {
  id        String   @id @default(cuid())
  slug      String   @unique
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  blogs    BlogTag[]
  projects TagsOnProjects[]

  @@map("tags")
}

model BlogTag {
  blogId    String
  tagId     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  blog Blog @relation(fields: [blogId], references: [id], onDelete: Cascade)
  tag  Tag  @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([blogId, tagId])
  @@index([tagId], map: "idx_blog_tags_tag_id")
  @@map("blog_tags")
}

model TagsOnProjects {
  projectId String
  tagId     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([projectId, tagId])
  @@index([tagId], map: "idx_project_tag_tag_id")
  @@map("project_tag")
}

// ===============================
// TRANSLATIONS
// ===============================
model Translation {
  id           String   @id @default(cuid())
  sourceText   String   @db.Text // Original text
  translated   String   @db.Text // Translated value
  language     String // "vi", "en", ...
  resourceType String? // "project", "blog", etc.
  resourceId   String? // Optional foreign key id
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@unique([sourceText, language], map: "uq_translations_sourceText_language")
  @@index([resourceType, resourceId], map: "idx_translations_resource")
  @@map("translations")
}
